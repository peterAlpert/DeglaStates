<div class="container py-4 w-75 shadow-sm">
    <div class="card shadow bg-dark text-light border-warning">
        <div class="card-body">
            <h3 class="mt-2 mb-4 text-center" style="color: #FFD700; font-weight: bold;">
                ๐ ุชุณุฌูู ูุฎุงููุฉ ูุญู
            </h3>

            <div class="my-3 text-end">
                <button class="btn btn-sm btn-outline-info px-4" routerLink="/placeViolations">๐ ุนุฑุถ ุงูุณุฌู</button>
            </div>

            <!-- Form -->
            <form (ngSubmit)="submitForm()" dir="rtl" class="mt-3">
                <!-- ุงูุชุงุฑูุฎ ูุงูููู -->
                <!-- <div class="row g-3 mb-3">
                    <div class="col-md-6">
                        <label class="form-label fw-bold">ุชุงุฑูุฎ</label>
                        <input type="date" [(ngModel)]="formData.date" name="date"
                            class="form-control bg-dark text-light border-warning" (change)="onDateChange()" />
                    </div>

                    <div class="col-md-6">
                        <label class="form-label fw-bold">ุงูููู</label>
                        <input type="text" [(ngModel)]="formData.day" name="day"
                            class="form-control bg-dark text-light border-secondary" readonly />
                    </div>
                </div> -->

                <!-- ุฒุฑ ููู ุงูุชุงุฑูุฎ ูุงูููุช -->
                <div class="text-end mb-2">
                    <button class="btn btn-sm btn-outline-light" (click)="toggleLockDateTime()">
                        {{ lockDateTime ? '๐ ูุชุญ ุงูุชุงุฑูุฎ ูุงูููุช' : '๐ ููู ุงูุชุงุฑูุฎ ูุงูููุช' }}
                    </button>
                </div>

                <!-- ุงูุชุงุฑูุฎ ูุงูููู -->
                <div class="row g-3 mb-3">
                    <div class="col-md-6">
                        <label class="form-label fw-bold">ุชุงุฑูุฎ</label>
                        <input type="date" [(ngModel)]="formData.date" name="date"
                            class="form-control bg-dark text-light border-warning" [readonly]="lockDateTime"
                            (change)="onDateChange()" />
                    </div>

                    <div class="col-md-6">
                        <label class="form-label fw-bold">ุงูููู</label>
                        <input type="text" [(ngModel)]="formData.day" name="day"
                            class="form-control bg-dark text-light border-secondary" readonly />
                    </div>
                </div>


                <!-- ุจุงูู ุงูุญููู -->
                <div class="row g-3" *ngFor="let field of fields">
                    <div class="col-md-8" *ngIf="field.key !== 'date' && field.key !== 'day' && field.key !== 'store'">
                        <div class="input-group gap-3 my-1">
                            <input [(ngModel)]="formData[field.key]" name="{{ field.key }}"
                                [type]="field.type || 'text'" class="form-control bg-dark text-light border-light"
                                placeholder="{{field.label}}" #fieldInput />

                            <!-- ุฒุฑ ุงููุงูู -->
                            <button type="button" class="btn rounded-circle ms-1" [ngClass]="{
                'btn-outline-warning': !(isRecognizing && activeField === field.key),
                'btn-warning pulse': isRecognizing && activeField === field.key
              }" (mousedown)="startRecognition(field.key)" (mouseup)="stopRecognition()"
                                (mouseleave)="stopRecognition()" title="ุงุถุบุท ูุงุณุชูุฑ ููุชุณุฌูู">
                                {{ isRecognizing && activeField === field.key ? '๐๏ธ' : '๐ค' }}
                            </button>

                            <!-- ุฒุฑ ุงููุณุญ -->
                            <button type="button" class="btn btn-outline-danger ms-1" (click)="clearField(field.key)"
                                title="ูุณุญ ุงูุญูู">
                                ๐๏ธ
                            </button>
                        </div>
                    </div>

                    <!-- ๐ก ุญูู ุงุณู ุงููุญู Dropdown -->
                    <div class="col-md-8" *ngIf="field.key === 'store'">
                        <div class="input-group gap-3 my-1">
                            <label class="form-label fw-bold">ุงููุญู</label>
                            <select [(ngModel)]="formData.store" name="store"
                                class="form-select bg-dark text-light border-light">
                                <option *ngFor="let s of storeOptions" [value]="s">{{ s }}</option>
                            </select>

                            <!-- ุฒุฑ ุงููุงูู -->
                            <button type="button" class="btn rounded-circle ms-1" [ngClass]="{
                'btn-outline-warning': !(isRecognizing && activeField === 'store'),
                'btn-warning pulse': isRecognizing && activeField === 'store'
              }" (mousedown)="startRecognition('store')" (mouseup)="stopRecognition()" (mouseleave)="stopRecognition()"
                                title="ุงุถุบุท ูุงุณุชูุฑ ููุชุณุฌูู">
                                {{ isRecognizing && activeField === 'store' ? '๐๏ธ' : '๐ค' }}
                            </button>

                            <!-- ุฒุฑ ุงููุณุญ -->
                            <button type="button" class="btn btn-outline-danger ms-1" (click)="clearField('store')"
                                title="ูุณุญ ุงูุญูู">
                                ๐๏ธ
                            </button>
                        </div>
                    </div>
                </div>

                <!-- ุฒุฑ ุงูุฅุฑุณุงู -->
                <div class="text-center mt-4 mb-3">
                    <button type="submit" class="btn btn-lg px-5 fw-bold" [disabled]="!isFormValid() || isSubmitting"
                        style="background-color: #FFD700; color: black; border: none;">
                        {{ isSubmitting ? 'โณ ุฌุงุฑู ุงูุฅุฏุฎุงู...' : 'โ ุฅุฏุฎุงู' }}
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Animation Style -->
<style>
    .pulse {
        animation: pulse-animation 1s infinite;
    }

    @keyframes pulse-animation {
        0% {
            box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7);
        }

        70% {
            box-shadow: 0 0 0 10px rgba(255, 215, 0, 0);
        }

        100% {
            box-shadow: 0 0 0 0 rgba(255, 215, 0, 0);
        }
    }
</style>